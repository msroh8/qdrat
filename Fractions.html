<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø¹Ø¨ ÙˆØ§ÙÙ‡Ù… Ù‚ÙˆØ§ÙŠÙ† Ø§Ù„ÙƒØ³ÙˆØ± ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù‚Ø¯Ø±Ø§Øª</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font: Tajawal (Better for Arabic) -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for Card/Felt theme */
        body {
            /* Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®Ø· ØªØ¬ÙˆÙ„ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ */
            font-family: 'Tajawal', Tahoma, sans-serif;
            background-color: #166534; /* Dark green felt */
            background-image: radial-gradient(#104e25 10%, #166534 60%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .card-shadow {
            box-shadow: 0 10px 20px rgba(0,0,0,0.5), 0 0 0 8px #fef3c7; /* Inner border like a card edge */
        }

        .score-board {
            background-color: #fef3c7; /* Light beige/cream */
            border: 4px solid #b45309; /* Dark brown border */
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            /* Ø¥Ø¶Ø§ÙØ© Ø®Ø§ØµÙŠØ© Flexbox Ù„ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© */
            display: flex; 
            flex-direction: column;
            gap: 10px;
        }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙˆÙ„ÙˆØ­Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„Ø¶Ù…Ø§Ù† Ø¸Ù‡ÙˆØ±Ù‡Ø§ Ø¨Ø¬Ø§Ù†Ø¨ Ø¨Ø¹Ø¶ */
        .score-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        /* Custom text shadow for the new header */
        .text-shadow-deluxe {
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.6);
        }

        .answer-button {
            transition: all 0.2s;
        }
        .answer-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        .correct-answer {
            background-color: #10b981 !important;
            color: white !important;
        }
        .wrong-answer {
            background-color: #ef4444 !important;
            color: white !important;
        }

        /* 3D Flip Card Styles */
        .flip-card {
            perspective: 1000px;
            width: 100%;
            padding-top: 140%; /* 7:5 aspect ratio */
            position: relative;
            cursor: pointer;
        }

        .flip-card-inner {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }

        .flip-card.flipped .flip-card-inner {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden; /* Safari */
            backface-visibility: hidden;
            border-radius: 1.5rem; /* rounded-3xl */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            text-align: center; /* Ø¶Ù…Ø§Ù† Ø§Ù„ØªÙˆØ³ÙŠØ· */
        }

        /* Video Cards (Red) */
        .card-back.video-card {
            background-color: #b91c1c; /* Red Card Back */
            color: white;
            border: 8px solid #fef3c7;
            background-image: repeating-linear-gradient(45deg, rgba(255,255,255,0.1) 0, rgba(255,255,255,0.1) 1px, transparent 1px, transparent 5px);
            font-size: 1.5rem;
            font-weight: bold;
        }

        /* Custom Cards (Indigo/Purple) */
        .card-back.custom-card {
            background-color: #4338ca; /* Indigo/Purple Card Back */
            color: white;
            border: 8px solid #fef3c7;
            background-image: repeating-linear-gradient(45deg, rgba(255,255,255,0.1) 0, rgba(255,255,255,0.1) 1px, transparent 1px, transparent 5px);
            font-size: 1.5rem;
            font-weight: bold;
        }

        .card-front {
            background-color: white;
            color: #374151;
            transform: rotateY(180deg);
            border: 8px solid #fef3c7;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ù…Ø³Ø§Ø¦Ù„ */
        .arabic-numerals, .question-text {
            font-size: 2rem; 
            font-weight: 700;
            direction: rtl; /* Ø¶Ù…Ø§Ù† Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† Ù„Ù„ÙŠØ³Ø§Ø± */
        }
        
        #modal-question-text {
            color: #111827; 
            text-align: center; 
        }

        .answer-button.arabic-numerals {
            font-size: 1.75rem; 
            padding-top: 0.75rem;
            padding-bottom: 0.75rem;
        }


        @media (max-width: 640px) {
            .card-back {
                font-size: 1.2rem;
            }
            .question-text {
                font-size: 2.25rem;
            }
            .answer-button.arabic-numerals {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body class="p-4">

    <div id="game-container" class="w-full max-w-5xl mx-auto p-4 md:p-8">

        <!-- ===== HEADER SECTION ===== -->
        <div class="text-center mb-8 text-white">
            <h1 class="text-4xl md:text-5xl font-bold text-fef3c7 text-shadow-deluxe">
                Ø§Ù„Ø¹Ø¨ ÙˆØ§ÙÙ‡Ù… Ù‚ÙˆØ§ÙŠÙ† Ø§Ù„ÙƒØ³ÙˆØ± ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù‚Ø¯Ø±Ø§Øª
            </h1>
            <p class="text-md md:text-lg text-amber-100 opacity-80 mt-2">
                ÙÙƒØ±Ø© ÙˆØªØµÙ…ÙŠÙ…: Ù…Ø­Ù…Ø¯ Ù…Ø¬Ù…Ù…ÙŠ
            </p>
        </div>
        <!-- ===== END HEADER SECTION ===== -->


        <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ (Score Board) -->
        <div id="score-board" class="score-board rounded-lg p-3 mb-8 text-gray-900">
            <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯: Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ØªØ­Ø°ÙŠØ± + Ø¹Ù†ÙˆØ§Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
            <div class="score-header">
                <h2 class="text-2xl font-bold mb-0">ğŸƒ Ù„ÙˆØ­Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ğŸƒ</h2>
                
                <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ØªØ­Ø°ÙŠØ± (Ù…Ø±Ø¬Ø¹ Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ†) -->
                <div class="flex items-center space-x-2 space-x-reverse">
                    <button onclick="openRulesModal()" class="text-3xl text-red-600 p-1 rounded-full bg-yellow-300 hover:bg-yellow-400 transition duration-200" title="Ù…Ù„Ø®Øµ Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„ÙƒØ³ÙˆØ±">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-7 h-7">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="8" x2="12" y2="12"></line>
                            <line x1="12" y1="16" x2="12.01" y2="16"></line>
                        </svg>
                    </button>
                    <span class="text-lg font-bold text-red-600 select-none">Ù„Ø§ ØªØ¶ØºØ· Ù‡Ù†Ø§!</span>
                </div>
            </div>

            <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù†ØªÙŠØ¬Ø© -->
            <div class="text-xl font-semibold flex flex-wrap justify-center gap-4 mt-2">
                <span>Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score" class="text-green-700">Ù </span></span>
                <span>Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©: <span id="completed-cards-count">Ù </span> / <span id="total-questions">Ù¨</span></span>
                <!-- Joker Counter -->
                <span>Ø§Ù„Ø¬ÙˆÙƒØ±: <span id="joker-uses" class="text-yellow-700">Ù </span></span>
            </div>
        </div>

        <!-- Ø´Ø¨ÙƒØ© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ù‚Ù„ÙˆØ¨Ø© -->
        <div id="card-grid" class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-4 gap-6 mb-8">
            <!-- Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø³ÙŠØªÙ… Ø­Ù‚Ù†Ù‡Ø§ Ù‡Ù†Ø§ -->
        </div>

        <!-- Ù…ÙˆØ¯Ø§Ù„ (Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø©) Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„ ÙˆØ§Ù„Ø¥Ø¬Ø§Ø¨Ø© -->
        <div id="question-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50" style="display: none;">
            <div class="bg-white card-shadow rounded-3xl p-6 md:p-10 w-full max-w-md flex flex-col justify-between" id="active-card-content">
                
                <!-- Question Content -->
                <div class="flex-grow flex flex-col justify-center items-center">
                    
                    <!-- Joker Button - Show only for video questions -->
                    <button id="joker-button" onclick="useJoker()" class="answer-button mb-6 px-4 py-2 bg-yellow-500 text-white text-sm font-bold rounded-full shadow-lg hover:bg-yellow-600 transition duration-150 flex items-center gap-1" style="display: none;">
                        <span class="text-xl">ğŸƒ</span> Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬ÙˆÙƒØ± (Ø´Ø±Ø­ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ)
                    </button>
                    
                    <p id="modal-question-text" class="text-xl md:text-2xl font-medium text-gray-700 mb-6 max-w-full leading-relaxed text-center">
                        <!-- Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„ ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                    </p>

                    <!-- Options -->
                    <div id="modal-options-container" class="grid grid-cols-1 sm:grid-cols-2 gap-4 w-full max-w-md mx-auto">
                        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                    </div>
                </div>

                <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØ²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ -->
                <div class="mt-8">
                    <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„Ø© -->
                    <div id="modal-message-box" class="mt-4 p-3 bg-yellow-100 text-yellow-800 rounded-lg font-semibold" style="display: none;">
                        <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„Ø© ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                    </div>

                    <!-- Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ -->
                    <button id="close-modal-button" onclick="closeModal()" class="answer-button w-full mt-4 px-8 py-3 bg-blue-600 text-white text-lg font-bold rounded-xl shadow-md hover:bg-blue-700 transition duration-150" style="display: none;">
                        Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ÙˆØ§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¹Ø¨
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Ù…ÙˆØ¯Ø§Ù„ Ù…Ù„Ø®Øµ Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† (Ø¬Ø¯ÙŠØ¯ ÙˆÙ…ÙØµØºÙ‘ÙØ±) -->
        <div id="rules-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50" style="display: none;">
            <div class="bg-white card-shadow rounded-3xl p-6 md:p-8 w-full max-w-sm flex flex-col justify-between">
                <h2 class="text-2xl font-extrabold text-blue-800 mb-5 text-center">Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„ÙƒØ³ÙˆØ± - Ù…Ø±Ø¬Ø¹ Ø³Ø±ÙŠØ¹</h2>
                <div class="space-y-4 text-gray-700 text-base">
                    <div class="p-3 bg-gray-50 rounded-lg border-r-4 border-red-500">
                        <h3 class="font-bold text-lg mb-1 text-red-700">Ù¡. Ø§Ù„Ø¬Ù…Ø¹ ÙˆØ§Ù„Ø·Ø±Ø­:</h3>
                        <p class="mr-3 text-sm">ÙŠØ¬Ø¨ ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ù…Ù‚Ø§Ù…Ø§Øª Ø£ÙˆÙ„Ø§Ù‹ØŒ Ø«Ù… ØªÙØ¬Ù…Ø¹ Ø£Ùˆ ØªÙØ·Ø±Ø­ Ø§Ù„Ø¨Ø³ÙˆØ·.</p>
                    </div>
                    <div class="p-3 bg-gray-50 rounded-lg border-r-4 border-green-500">
                        <h3 class="font-bold text-lg mb-1 text-green-700">Ù¢. Ø§Ù„Ø¶Ø±Ø¨:</h3>
                        <p class="mr-3 text-sm">ØªÙØ¶Ø±Ø¨ Ø§Ù„Ø¨Ø³ÙˆØ· ÙˆØ§Ù„Ù…Ù‚Ø§Ù…Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø©.</p>
                    </div>
                    <div class="p-3 bg-gray-50 rounded-lg border-r-4 border-yellow-500">
                        <h3 class="font-bold text-lg mb-1 text-yellow-700">Ù£. Ø§Ù„Ù‚Ø³Ù…Ø©:</h3>
                        <p class="mr-3 text-sm">ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù‚Ø³Ù…Ø© Ù„Ø¶Ø±Ø¨ Ù…Ø¹ Ù‚Ù„Ø¨ Ø§Ù„ÙƒØ³Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ.</p>
                    </div>
                    <div class="p-3 bg-gray-50 rounded-lg border-r-4 border-indigo-500">
                        <h3 class="font-bold text-lg mb-1 text-indigo-700">Ù¤. Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:</h3>
                        <p class="mr-3 text-sm">Ø§Ù„Ø¶Ø±Ø¨ ÙˆØ§Ù„Ù‚Ø³Ù…Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¬Ù…Ø¹ ÙˆØ§Ù„Ø·Ø±Ø­.</p>
                    </div>
                </div>
                <button onclick="closeRulesModal()" class="answer-button w-full mt-6 px-8 py-3 bg-blue-600 text-white text-lg font-bold rounded-xl shadow-md hover:bg-blue-700 transition duration-150">
                    Ø¥ØºÙ„Ø§Ù‚ ÙˆØ§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¹Ø¨
                </button>
            </div>
        </div>

        <!-- Ø´Ø§Ø´Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© -->
        <div id="end-screen" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50" style="display: none;">
            <div class="bg-white card-shadow rounded-3xl p-10 max-w-md">
                <h2 class="text-4xl font-bold text-green-700 mb-4">ğŸ† Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬ÙˆÙ„Ø©! ğŸ†</h2>
                <p class="text-xl text-gray-700 mb-6">Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ø¬Ù…ÙŠØ¹ Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„ÙƒØ³ÙˆØ±.</p>
                <p class="text-3xl font-extrabold text-gray-900 mb-8">Ù†Ù‚Ø§Ø·Ùƒ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: <span id="final-score" class="text-red-600"></span></p>
                <button onclick="startGame()" class="answer-button px-8 py-3 bg-amber-500 text-white text-lg font-bold rounded-xl shadow-md hover:bg-amber-600 transition duration-150">
                    Ø¨Ø¯Ø¡ Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©
                </button>
            </div>
        </div>
        
        <!-- ===== FOOTER SECTION (Ù…ÙØ¹Ø¯Ù‘ÙÙ„) ===== -->
        <footer class="mt-12 pt-6 border-t border-amber-200 border-opacity-30 text-center">
            <p class="text-md font-semibold text-amber-100 text-shadow-deluxe">
                Ø¬Ù…ÙŠØ¹ Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…Ø´Ø§Ø± Ù„Ù‡ Ù…Ù† Ù‚Ù†ÙˆØ§Øª Ù…Ù†Ø´Ø¦ÙŠÙ‡
            </p>
        </footer>
        <!-- ===== END FOOTER SECTION ===== -->


    </div>

    <script>
        // Set the global variables for the game
        let score = 0;
        let answered = false;
        let completedCardsCount = 0;
        let jokerUses = 0; // Joker counter
        let currentQuestionData = null; // Stores the data of the currently opened card
        
        const rulesModal = document.getElementById('rules-modal'); // Get the new modal element

        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ø¥Ù„Ù‰ Ø¹Ø±Ø¨ÙŠØ©
        function toArabicNumerals(numStr) {
            const arabicNumerals = ['Ù ', 'Ù¡', 'Ù¢', 'Ù£', 'Ù¤', 'Ù¥', 'Ù¦', 'Ù§', 'Ù¨', 'Ù©'];
            return String(numStr).replace(/[0-9]/g, (match) => arabicNumerals[parseInt(match)]);
        }

        // Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø­Ø¯Ø«Ø© Ø¨Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆØ§Ù„ÙƒØ³ÙˆØ± ÙƒÙ†Øµ Ø¹Ø±Ø¨ÙŠ Ø¹Ø§Ø¯ÙŠ
        const questions = [
            // ===== Video-Linked Questions (type: 'video') - Red Cards - TEXT only =====
            {
                id: 1,
                category: "Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¬Ù…Ø¹ ÙˆØ§Ù„Ø·Ø±Ø­ (Ø´Ø±Ø­)",
                text: "Ù¡/Ù¢ + Ù¡/Ù£ = ØŸ", 
                options: ["Ù¢/Ù¥", "Ù¡/Ù¦", "Ù¥/Ù¦", "Ù£/Ù¥"], 
                answer: "Ù¥/Ù¦", 
                explanation: "Ø¨ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ù…Ù‚Ø§Ù…Ø§Øª (Ø·Ø±ÙŠÙ‚Ø© Ù„Ø§)ØŒ (Ù£Ã—Ù¡) + (Ù¢Ã—Ù¡) Ù…Ù‚Ø³ÙˆÙ… Ø¹Ù„Ù‰ (Ù¢Ã—Ù£) = Ù¥/Ù¦",
                isAnswered: false,
                isCorrect: false,
                youtubeUrl: "https://www.youtube.com/watch?v=TDDb4GUJa6I&t=85s", // 01:25
                jokerUsed: false,
                type: 'video'
            },
            {
                id: 2,
                category: "Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¶Ø±Ø¨ (Ø´Ø±Ø­)",
                text: "Ù¤/Ù¥ Ã— Ù¢/Ù£ = ØŸ", 
                options: ["Ù¦/Ù¨", "Ù¨/Ù¡Ù¥", "Ù¡Ù¢/Ù¡Ù ", "Ù¨/Ù¥"], 
                answer: "Ù¨/Ù¡Ù¥", 
                explanation: "Ù†Ø¶Ø±Ø¨ Ø§Ù„Ø¨Ø³Ø· ÙÙŠ Ø§Ù„Ø¨Ø³Ø· ÙˆØ§Ù„Ù…Ù‚Ø§Ù… ÙÙŠ Ø§Ù„Ù…Ù‚Ø§Ù…. (Ù¤ Ã— Ù¢) Ù…Ù‚Ø³ÙˆÙ… Ø¹Ù„Ù‰ (Ù¥ Ã— Ù£) = Ù¨/Ù¡Ù¥",
                isAnswered: false,
                isCorrect: false,
                youtubeUrl: "https://www.youtube.com/watch?v=TDDb4GUJa6I&t=336s", // 05:36
                jokerUsed: false,
                type: 'video'
            },
            {
                id: 3,
                category: "Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ù‚Ø³Ù…Ø© (Ø´Ø±Ø­)",
                text: "Ù£/Ù¤ Ã· Ù¡/Ù¢ = ØŸ", 
                options: ["Ù£/Ù¨", "Ù¡/Ù¢", "Ù£/Ù¢", "Ù¤/Ù¦"], 
                answer: "Ù£/Ù¢", 
                explanation: "Ù†Ø«Ø¨Øª Ø§Ù„ÙƒØ³Ø± Ø§Ù„Ø£ÙˆÙ„ØŒ Ù†Ø­ÙˆÙ„ Ø§Ù„Ù‚Ø³Ù…Ø© Ù„Ø¶Ø±Ø¨ØŒ ÙˆÙ†Ù‚Ù„Ø¨ Ø§Ù„ÙƒØ³Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ. Ù£/Ù¤ Ã— Ù¢/Ù¡ = Ù¦/Ù¤ = Ù£/Ù¢",
                isAnswered: false,
                isCorrect: false,
                youtubeUrl: "https://www.youtube.com/watch?v=TDDb4GUJa6I&t=377s", // 06:17
                jokerUsed: false,
                type: 'video'
            },
            {
                id: 4,
                category: "ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª (Ø´Ø±Ø­)",
                text: "Ù¡/Ù¦ + Ù¡/Ù£ Ã— Ù¡/Ù¢ = ØŸ", 
                options: ["Ù¡/Ù£", "Ù¢/Ù¥", "Ù¡/Ù¡Ù¢", "Ù¢/Ù£"], 
                answer: "Ù¡/Ù£", 
                explanation: "Ø§Ù„Ø¶Ø±Ø¨ Ø£ÙˆÙ„Ø§Ù‹. (Ù¡/Ù£ Ã— Ù¡/Ù¢) = Ù¡/Ù¦. Ø«Ù… Ù†Ø¬Ù…Ø¹: Ù¡/Ù¦ + Ù¡/Ù¦ = Ù¢/Ù¦ = Ù¡/Ù£",
                isAnswered: false,
                isCorrect: false,
                youtubeUrl: "https://www.youtube.com/watch?v=TDDb4GUJa6I&t=513s", // 08:33
                jokerUsed: false,
                type: 'video'
            },
            // ===== Custom Application Questions (type: 'custom') - Indigo Cards - TEXT only =====
            {
                id: 5,
                category: "ØªØ¨Ø³ÙŠØ· Ø§Ù„ÙƒØ³ÙˆØ± (ØªØ·Ø¨ÙŠÙ‚)",
                text: "(Ù¨Ù¨ + Ù¨Ù¨ + Ù¨Ù¨) / Ù¨Ù¨ = ØŸ", 
                options: ["Ù£", "Ù¨Ù¨", "Ù¨Ù¨/Ù£", "Ù¡"], 
                answer: "Ù£", 
                explanation: "Ù†Ø­ÙˆÙ„ Ø§Ù„Ø¬Ù…Ø¹ Ø§Ù„Ù…ØªÙƒØ±Ø± Ø¥Ù„Ù‰ Ø¶Ø±Ø¨: (Ù¨Ù¨ Ã— Ù£) / Ù¨Ù¨. Ù†Ø­Ø°Ù Ù¨Ù¨ Ù…Ù† Ø§Ù„Ø¨Ø³Ø· ÙˆØ§Ù„Ù…Ù‚Ø§Ù…ØŒ ÙˆØ§Ù„Ù†Ø§ØªØ¬ Ù‡Ùˆ Ù£.",
                isAnswered: false,
                isCorrect: false,
                jokerUsed: false,
                type: 'custom'
            },
            {
                id: 6,
                category: "Ø¬Ù…Ø¹ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙƒØ³Ø±ÙŠØ© (ØªØ·Ø¨ÙŠÙ‚)",
                text: "Ù¡ Ùˆ Ù¡/Ù¤ + Ù¢ Ùˆ Ù£/Ù¤ = ØŸ", 
                options: ["Ù¤", "Ù£ Ùˆ Ù¤/Ù¨", "Ù¥", "Ù¤ Ùˆ Ù¡/Ù¢"],
                answer: "Ù¤",
                explanation: "Ù†Ø¬Ù…Ø¹ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØµØ­ÙŠØ­Ø© (Ù¡+Ù¢=Ù£)ØŒ ÙˆÙ†Ø¬Ù…Ø¹ Ø§Ù„ÙƒØ³ÙˆØ± (Ù¡/Ù¤ + Ù£/Ù¤ = Ù¤/Ù¤ = Ù¡). Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: Ù£ + Ù¡ = Ù¤.",
                isAnswered: false,
                isCorrect: false,
                jokerUsed: false,
                type: 'custom'
            },
            {
                id: 7,
                category: "Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„ÙƒØ³ÙˆØ± (ØªØ·Ø¨ÙŠÙ‚)",
                text: "Ø±ØªØ¨ Ù…Ù† Ø§Ù„Ø£ØµØºØ± Ù„Ù„Ø£ÙƒØ¨Ø±: Ù¡/Ù¥ØŒ Ù¡/Ù¢ØŒ Ù¡/Ù£",
                options: ["Ù¡/Ù¢ØŒ Ù¡/Ù£ØŒ Ù¡/Ù¥", "Ù¡/Ù¥ØŒ Ù¡/Ù£ØŒ Ù¡/Ù¢", "Ù¡/Ù¢ØŒ Ù¡/Ù¥ØŒ Ù¡/Ù£", "Ù¡/Ù£ØŒ Ù¡/Ù¢ØŒ Ù¡/Ù¥"],
                answer: "Ù¡/Ù¥ØŒ Ù¡/Ù£ØŒ Ù¡/Ù¢",
                explanation: "Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙƒÙˆÙ† Ø§Ù„Ø¨Ø³Ø· Ø«Ø§Ø¨ØªØ§Ù‹ (Ù¡)ØŒ ÙŠÙƒÙˆÙ† Ø§Ù„ÙƒØ³Ø± Ø§Ù„Ø£ØµØºØ± Ù‡Ùˆ ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ù‚Ø§Ù… Ø§Ù„Ø£ÙƒØ¨Ø±. ÙˆØ¨Ø§Ù„ØªØ§Ù„ÙŠ: Ù¡/Ù¥ (Ø§Ù„Ø£ØµØºØ±) < Ù¡/Ù£ < Ù¡/Ù¢ (Ø§Ù„Ø£ÙƒØ¨Ø±).",
                isAnswered: false,
                isCorrect: false,
                jokerUsed: false,
                type: 'custom'
            },
            {
                id: 8,
                category: "Ø¶Ø±Ø¨ Ø¹Ø¯Ø¯ ÙÙŠ ÙƒØ³Ø± (ØªØ·Ø¨ÙŠÙ‚)",
                text: "Ù¡Ù  Ã— Ù¢/Ù¥ = ØŸ",
                options: ["Ù¢Ù /Ù¥Ù ", "Ù¤", "Ù¡Ù /Ù¥", "Ù¢Ù "],
                answer: "Ù¤",
                explanation: "Ù†Ø¶Ø±Ø¨ Ø§Ù„Ø¹Ø¯Ø¯ ÙÙŠ Ø§Ù„Ø¨Ø³Ø· ÙˆÙ†Ù‚Ø³Ù… Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù‚Ø§Ù…: (Ù¡Ù  Ã— Ù¢) Ù…Ù‚Ø³ÙˆÙ… Ø¹Ù„Ù‰ Ù¥ = Ù¢Ù /Ù¥ = Ù¤.",
                isAnswered: false,
                isCorrect: false,
                jokerUsed: false,
                type: 'custom'
            }
        ];


        // Get DOM elements
        const cardGrid = document.getElementById('card-grid');
        const questionModal = document.getElementById('question-modal');
        const endScreen = document.getElementById('end-screen');
        const scoreElement = document.getElementById('score');
        const completedCardsCountElement = document.getElementById('completed-cards-count');
        const totalQuestionsElement = document.getElementById('total-questions');
        const modalQuestionText = document.getElementById('modal-question-text');
        const modalOptionsContainer = document.getElementById('modal-options-container');
        const modalMessageBox = document.getElementById('modal-message-box');
        const closeModalButton = document.getElementById('close-modal-button');
        const finalScoreElement = document.getElementById('final-score');
        const jokerUsesElement = document.getElementById('joker-uses'); // Joker uses element
        const jokerButton = document.getElementById('joker-button'); // Joker button element

        // Initialize game on load
        document.addEventListener('DOMContentLoaded', () => {
            totalQuestionsElement.textContent = toArabicNumerals(questions.length);
            startGame();
        });

        function startGame() {
            score = 0;
            completedCardsCount = 0;
            jokerUses = 0; // Reset joker counter

            // Reset the state of all questions
            questions.forEach(q => {
                q.isAnswered = false;
                q.isCorrect = false;
                q.jokerUsed = false; // Reset joker usage state
            });

            questionModal.style.display = 'none';
            rulesModal.style.display = 'none'; // Ensure rules modal is closed
            endScreen.style.display = 'none';
            updateScoreBoard();
            renderCards();
        }

        function updateScoreBoard() {
            scoreElement.textContent = toArabicNumerals(score);
            completedCardsCountElement.textContent = toArabicNumerals(completedCardsCount);
            jokerUsesElement.textContent = toArabicNumerals(jokerUses); // Update joker uses
            if (completedCardsCount === questions.length) {
                showEndScreen();
            }
        }

        function renderCards() {
            cardGrid.innerHTML = ''; // Clear previous cards

            questions.forEach(q => {
                const cardWrapper = document.createElement('div');
                cardWrapper.className = `flip-card ${q.isAnswered ? 'answered' : ''} ${q.isCorrect ? 'bg-green-100' : ''}`;
                cardWrapper.id = `card-${q.id}`;
                
                // Add event listener only if not answered
                if (!q.isAnswered) {
                    cardWrapper.onclick = () => openCard(q);
                }
                
                let cardIcon = q.type === 'video' ? 'ğŸ”´' : 'ğŸ’¡'; // Red dot for video, bulb for custom
                if (q.jokerUsed) {
                     cardIcon = 'ğŸƒğŸ¤“'; // Joker used (Smart Joker)
                } else if (q.isAnswered) {
                    // Show happy/sad joker only on the card front after answering
                    cardIcon = q.isCorrect ? 'ğŸƒğŸ˜Š' : 'ğŸƒğŸ˜”';
                }
                
                // Determine card back color
                const cardBackColorClass = q.type === 'video' ? 'video-card' : 'custom-card';

                cardWrapper.innerHTML = `
                    <div class="flip-card-inner ${q.isAnswered ? 'flipped' : ''}">
                        <!-- Card Back: Visible when not flipped/answered -->
                        <div class="card-face card-back ${cardBackColorClass}">
                            <span class="text-6xl mb-4">${cardIcon}</span>
                            ${q.category}
                        </div>
                        <!-- Card Front: Question & Status -->
                        <div class="card-face card-front p-4 md:p-6 justify-center">
                            <div class="text-lg font-semibold text-gray-900 mb-2">${q.category}</div>
                            <div class="text-2xl font-bold ${q.isCorrect ? 'text-green-600' : 'text-red-600'}">
                                ${q.isAnswered ? (q.isCorrect ? 'ØµØ­ÙŠØ­ âœ”ï¸' : 'Ø®Ø·Ø£ âŒ') : 'Ø§Ù†Ù‚Ø± Ù„Ù„Ø¨Ø¯Ø¡'}
                            </div>
                        </div>
                    </div>
                `;
                cardGrid.appendChild(cardWrapper);
            });
        }

        function openCard(question) {
            if (question.isAnswered) return; // Cannot re-open answered card

            currentQuestionData = question;
            answered = false;
            
            // Show modal and reset content
            questionModal.style.display = 'flex';
            rulesModal.style.display = 'none'; // Ensure rules modal is closed
            modalMessageBox.style.display = 'none';
            closeModalButton.style.display = 'none';
            
            // Manage Joker button state: Only show if it is a video question AND not already used
            if (question.type === 'video' && !question.jokerUsed) {
                jokerButton.style.display = 'flex';
                jokerButton.disabled = false;
                jokerButton.innerHTML = 'ğŸƒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬ÙˆÙƒØ± (Ø´Ø±Ø­ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ)';
            } else {
                jokerButton.style.display = 'none';
            }

            // Load question text (Plain Arabic Text)
            modalQuestionText.innerHTML = `<span class="question-text">${question.text}</span>`;
            
            // Load options (Plain Arabic Text)
            modalOptionsContainer.innerHTML = '';
            
            question.options.forEach(option => {
                const button = document.createElement('button');
                button.setAttribute('data-answer', option);
                button.className = 'answer-button arabic-numerals px-4 py-3 bg-gray-100 text-gray-800 text-lg font-semibold rounded-xl border-2 border-gray-300 hover:bg-gray-200 transition duration-150 text-center';
                button.onclick = () => handleAnswer(button, question);
                
                // Set button text
                button.textContent = option;

                modalOptionsContainer.appendChild(button);
            });
            // No MathJax rendering needed here
        }
        
        // Handle Joker use
        function useJoker() {
            if (!currentQuestionData || currentQuestionData.jokerUsed || currentQuestionData.type !== 'video') return;

            // 1. Increment global counter
            jokerUses++;
            
            // 2. Mark Joker as used for this specific question
            currentQuestionData.jokerUsed = true;
            
            // 3. Disable the button and update status visually with two jokers
            jokerButton.disabled = true;
            jokerButton.innerHTML = 'ğŸƒğŸ¤“ ğŸƒ ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¬ÙˆÙƒØ± ğŸš€'; // Two jokers: Smirking/Smart and normal
            
            // 4. Update the score board
            updateScoreBoard();
            
            // 5. Open the YouTube link in a new tab
            window.open(currentQuestionData.youtubeUrl, '_blank');
            
            // 6. Provide a message in the message box
            modalMessageBox.className = 'mt-4 p-3 bg-yellow-100 text-yellow-800 rounded-lg font-semibold';
            modalMessageBox.innerHTML = 'ØªÙ… ÙØªØ­ Ø´Ø±Ø­ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©. Ù„Ø§ ØªÙ†Ø³Ù Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø©!';
            modalMessageBox.style.display = 'block';
        }

        function handleAnswer(selectedButton, question) {
            if (answered) return;

            answered = true;
            closeModalButton.style.display = 'block';
            jokerButton.style.display = 'none'; // Hide Joker button once answered

            const selected = selectedButton.getAttribute('data-answer');
            const isCorrect = (selected === question.answer);
            
            question.isAnswered = true;
            question.isCorrect = isCorrect;
            completedCardsCount++;

            // Update score
            if (isCorrect) {
                score += 1;
                modalMessageBox.className = 'mt-4 p-3 bg-green-100 text-green-800 rounded-lg font-semibold';
                modalMessageBox.innerHTML = `ØµØ­ÙŠØ­! ğŸ‰ <span class="text-3xl">ğŸƒğŸ˜Š</span> Ù„Ù‚Ø¯ ÙƒØ³Ø¨Øª Ù†Ù‚Ø·Ø©. <br> <span class="text-sm block mt-1">Ø§Ù„Ø´Ø±Ø­: ${question.explanation}</span>`;
            } else {
                modalMessageBox.className = 'mt-4 p-3 bg-red-100 text-red-800 rounded-lg font-semibold';
                modalMessageBox.innerHTML = `Ø®Ø·Ø£ ğŸ˜” <span class="text-3xl">ğŸƒğŸ˜”</span> Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù‡ÙŠ: <span class="font-extrabold">${question.answer}</span>. <br> <span class="text-sm block mt-1">Ø§Ù„Ø´Ø±Ø­: ${question.explanation}</span>`;
            }
            modalMessageBox.style.display = 'block';
            // No MathJax rendering needed here

            // Highlight answers
            const optionButtons = modalOptionsContainer.querySelectorAll('button');
            optionButtons.forEach(button => {
                button.disabled = true;
                button.classList.remove('hover:bg-gray-200');

                if (button.getAttribute('data-answer') === question.answer) {
                    button.classList.add('correct-answer', 'border-green-600');
                    button.classList.remove('bg-gray-100');
                } else if (button.getAttribute('data-answer') === selected) {
                    button.classList.add('wrong-answer', 'border-red-600');
                    button.classList.remove('bg-gray-100');
                }
            });

            updateScoreBoard();
            
            // Visually flip the card on the grid (delayed for smooth transition)
            setTimeout(() => {
                document.getElementById(`card-${question.id}`).classList.add('flipped');
                document.getElementById(`card-${question.id}`).onclick = null; // Disable click after flip
            }, 100);
        }
        
        function closeModal() {
            questionModal.style.display = 'none';
            renderCards(); // Re-render to ensure card flip status and icon is correctly displayed
        }

        function showEndScreen() {
            questionModal.style.display = 'none';
            endScreen.style.display = 'flex';
            finalScoreElement.textContent = `${toArabicNumerals(score)} / ${toArabicNumerals(questions.length)}`;
        }
        
        // Functions for the new Rules Modal
        function openRulesModal() {
            rulesModal.style.display = 'flex';
            questionModal.style.display = 'none'; // Close question modal if open
        }

        function closeRulesModal() {
            rulesModal.style.display = 'none';
        }
    </script>

</body>
</html>